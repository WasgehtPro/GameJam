[gd_scene load_steps=6 format=3 uid="uid://bmt1aict1k0h8"]

[ext_resource type="Texture2D" uid="uid://cs7ot8norqy2f" path="res://Player/Player.png" id="1_l0e7v"]
[ext_resource type="Texture2D" uid="uid://o5apaqd5uo82" path="res://LightMasks/StandartCone.png" id="3_8sk5g"]
[ext_resource type="Texture2D" uid="uid://cwfgiaku17qwe" path="res://LightMasks/StandartCircle.png" id="4_7jmii"]

[sub_resource type="GDScript" id="GDScript_5151p"]
script/source = "extends CharacterBody2D

var grabForce = 25
var pushForce = 1000
var speed = 75.0
var slowDown = speed * 0.2
var obj

@onready var hands = $Hands
@onready var grabRange: RayCast2D = $GrabRange

# Get the gravity from the project settings to be synced with RigidBody nodes.
var gravity = ProjectSettings.get_setting(\"physics/2d/default_gravity\")


func _physics_process(delta):

	look_at(get_global_mouse_position())
	
	# Get the input direction and handle the movement/deceleration.
	var direction = Vector2(Input.get_axis(\"Left\", \"Right\"), Input.get_axis(\"Up\", \"Down\"))
	
	if direction:
		if direction.length() > 1:
			direction = direction.normalized()
		velocity = direction * speed * delta * 50
	else:
		velocity = Vector2(move_toward(velocity.x, 0, slowDown), move_toward(velocity.y, 0, slowDown))
	
	if Input.is_action_pressed(\"Push\"):
		if not obj:
			obj = grabRange.get_collider()
			
		if obj is RigidBody2D:
			obj.collision_layer = 2
			obj.apply_force((hands.global_position - obj.global_position) * grabForce / obj.mass)	
	elif Input.is_action_just_released(\"Push\"):
		if obj:
			obj.collision_layer = 1
			obj = null
	
	
	
	if move_and_slide():
		var col = get_last_slide_collision()
		var obj: RigidBody2D = col.get_collider()
		if obj is RigidBody2D:
			obj.apply_force(col.get_normal() * -pushForce / obj.mass)
"

[sub_resource type="CircleShape2D" id="CircleShape2D_axj04"]
radius = 17.0

[node name="Player" type="CharacterBody2D"]
texture_filter = 1
script = SubResource("GDScript_5151p")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_axj04")

[node name="Sprite2D" type="Sprite2D" parent="."]
light_mask = 4
texture_filter = 1
texture = ExtResource("1_l0e7v")

[node name="PointLight2D" type="PointLight2D" parent="."]
shadow_enabled = true
texture = ExtResource("4_7jmii")
texture_scale = 0.5

[node name="PointLight2D2" type="PointLight2D" parent="."]
blend_mode = 2
range_item_cull_mask = 2
shadow_enabled = true
shadow_item_cull_mask = 2
texture = ExtResource("4_7jmii")
texture_scale = 0.5

[node name="PointLight2D3" type="PointLight2D" parent="."]
shadow_enabled = true
texture = ExtResource("3_8sk5g")
texture_scale = 2.0

[node name="PointLight2D4" type="PointLight2D" parent="."]
blend_mode = 2
range_item_cull_mask = 2
shadow_enabled = true
shadow_item_cull_mask = 2
texture = ExtResource("3_8sk5g")
texture_scale = 2.0

[node name="Hands" type="Node2D" parent="."]
position = Vector2(30, 0)

[node name="Camera2D" type="Camera2D" parent="."]
rotation = -1.5708
zoom = Vector2(2, 2)
position_smoothing_enabled = true

[node name="GrabRange" type="RayCast2D" parent="."]
target_position = Vector2(30, 0)
